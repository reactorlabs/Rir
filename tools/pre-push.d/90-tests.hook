#!/bin/bash

ROOT=$1

git diff --exit-code > /dev/null && git diff --cached --exit-code > /dev/null
if test "$?" -ne 0; then
  echo "please commit or stash your changes before pushing."
  exit 1
fi

. "${ROOT}/tools/script_include.sh"

build ${ROOT}/tests/build_push_hook ${ROOT} release

if test "$?" -ne 0; then
  echo "build failed. Please fix first."
  exit 1
fi

cd ${ROOT}/tests/build_push_hook

${ROOT}/tools/tests

if test "$?" -ne 0; then
  echo "make tests failed. Please fix first."
  exit 1
fi
