#!/bin/bash

ROOT=$1

DIFF=$(git diff)
if [ -n "$DIFF" ]; then
  echo "please commit before pushing."
  exit 1
fi

. "${ROOT}/tools/script_include.sh"

build ${ROOT}/tests/build_push_hook ${ROOT} release

if test "$?" -ne 0; then
  echo "build failed. Please fix first."
  exit 1
fi

cd ${ROOT}/tests/build_push_hook

${ROOT}/tools/tests

if test "$?" -ne 0; then
  echo "make tests failed. Please fix first."
  exit 1
fi
